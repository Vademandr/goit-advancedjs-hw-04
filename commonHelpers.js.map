{"version":3,"file":"commonHelpers.js","sources":["../src/api-service.js","../src/gallery.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\nexport { apiService };\n\naxios.defaults.baseURL = 'https://pixabay.com/api/';\nconst KEY = '40909869-b3da28e56daa62163d671a2ba';\n\nasync function apiService(query, page, perPage) {\n  const { data } = await axios.get(\n    `?key=${KEY}&q=${query}&image_type=photo&orientation=horizontal&safesearch=true&page=${page}&per_page=${perPage}`\n  );\n  return data;\n}","const gallery = document.querySelector('.gallery');\n\nexport function onRenderGallery(elements) {\n  const markup = elements\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `\n      <li class=\"photo-card\">\n        <a href=\"${largeImageURL}\">\n          <img class=\"photo-img\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n        </a>\n        <div class=\"info\">\n          <p class=\"info-item\"><b>Likes</b>${likes}</p>\n          <p class=\"info-item\"><b>Views</b>${views}</p>\n          <p class=\"info-item\"><b>Comments</b>${comments}</p>\n          <p class=\"info-item\"><b>Downloads</b>${downloads}</p>\n        </div>\n      </li>`;\n      }\n    )\n    .join('');\n\n  gallery.insertAdjacentHTML('beforeend', markup);\n}","import { apiService } from './api-service';\nimport { onRenderGallery } from './gallery';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst searchForm = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\n\nlet query = '';\nlet page = 1;\nlet simpleLightBox;\nconst perPage = 40;\nlet isLoading = false;\n\nsearchForm.addEventListener('submit', onSearch);\nwindow.addEventListener('scroll', handleScroll);\n\nasync function onSearch(event) {\n  event.preventDefault();\n  const newQuery = event.currentTarget.searchQuery.value.trim();\n\n  if (newQuery === query) {\n    iziToast.info({\n      title: 'Info',\n      message: `The previous ${query} request has already been received, please enter a new search parameter.`,\n      position: 'topRight',\n      color: 'blue',\n    });\n\n    return;\n  }\n\n  gallery.innerHTML = '';\n\n  if (!newQuery) {\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Please, fill the main field',\n      position: 'topRight',\n      color: 'yellow',\n    });\n\n    return;\n  }\n\n  query = newQuery;\n  page = 1;\n  gallery.innerHTML = '';\n\n  try {\n    const { hits, totalHits } = await apiService(query, page, perPage);\n\n    if (totalHits === 0) {\n      iziToast.error({\n        title: 'Error',\n        message:\n          'Sorry, there are no images matching your search query. Please try again.',\n        position: 'topRight',\n        color: 'red',\n      });\n      return;\n    }\n\n    onRenderGallery(hits);\n    simpleLightBox = new SimpleLightbox('.gallery a').refresh();\n\n    // Added code to check for end of results when submitting\n    const totalPages = Math.ceil(totalHits / perPage);\n\n    if (page >= totalPages) {\n      iziToast.info({\n        title: 'Info',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n        color: 'blue',\n      });\n      window.removeEventListener('scroll', handleScroll);\n    } else {\n      window.addEventListener('scroll', handleScroll);\n    }\n\n    iziToast.success({\n      title: 'Success',\n      message: `Hooray! We found ${totalHits} images !!!`,\n      position: 'topRight',\n      color: 'green',\n    });\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nasync function handleScroll() {\n  if (checkIfEndOfPage() && !isLoading) {\n    isLoading = true;\n    page += 1;\n\n    try {\n      const { hits, totalHits } = await apiService(query, page, perPage);\n      onRenderGallery(hits);\n      simpleLightBox.refresh();\n      const totalPages = Math.ceil(totalHits / perPage);\n\n      if (page >= totalPages) {\n        iziToast.info({\n          title: 'Info',\n          message: \"We're sorry, but you've reached the end of search results.\",\n          position: 'topRight',\n          color: 'blue',\n        });\n        window.removeEventListener('scroll', handleScroll);\n      }\n    } catch (error) {\n      console.log(error);\n    } finally {\n      isLoading = false;\n    }\n  }\n}\n\nfunction checkIfEndOfPage() {\n  return (\n    window.innerHeight + window.scrollY >= document.documentElement.scrollHeight\n  );\n}\n"],"names":["axios","KEY","apiService","query","page","perPage","data","gallery","onRenderGallery","elements","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","searchForm","simpleLightBox","isLoading","onSearch","handleScroll","event","newQuery","iziToast","hits","totalHits","SimpleLightbox","totalPages","error","checkIfEndOfPage"],"mappings":"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"}